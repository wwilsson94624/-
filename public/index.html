<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>資工系學會介紹</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <header>
    <img src="picture/ntoulogo.png" alt="海洋大學 LOGO" />
    <h1><a href="index.html">海大資工系學會介紹網站</a></h1>
    <nav>
      <a href="money.html">財務管理</a>
      <a href="calendar.html">活動日程</a>
      <a href="joinus.html">加入我們</a>
    </nav>
  </header>

  <main>
    <!-- 圖片輪播區 -->
    <section class="carousel">
      <button class="prev">上一張</button>
      <div class="image-container">
        <!-- 輪播圖片將動態加入 -->
      </div>
      <button class="next">下一張</button>
    </section>

    <!-- 關於學會的介紹 -->
    <section class="intro">
      <h2>關於資工系學會</h2>
      <p>
        資工系學會目前是由大二的學長姐們組成的，其中所有的幹部都由學生們擔任。
        系學會主要功能為傳達資工系上資訊給同學、增進同學間的感情和創造優良系風。
        資工系學會這學期舉辦各式各樣的活動，包括迎新茶會、三系聯合宿營、五系萬聖晚會等等。
      </p>
    </section>

    <!-- 圖片上傳區 -->
    <section class="upload-section">
      <h2>上傳活動圖片</h2>
      <form id="uploadForm">
        <input type="file" id="imageUpload" accept="image/*" required />
        <button type="submit">上傳圖片</button>
      </form>
    </section>
  </main>

  <footer>
    <p>
      聯絡我們：
      <br />
      <a href="mailto:ntoucssa@email.ntou.edu.tw">我們的信箱</a>
      <br />
      <a
        href="https://www.instagram.com/ntou_cse?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw==">Instagram</a>
    </p>
  </footer>

  <script>
    // ======== 輪播功能 ========
    let currentIndex = 0;
    const imageContainer = document.querySelector(".image-container");
    const prevButton = document.querySelector(".prev");
    const nextButton = document.querySelector(".next");

    function showImage(index) {
      const images = document.querySelectorAll(".image-container img");
      if (images.length === 0) return; // 如果沒有圖片則不執行
      images.forEach((img) => img.classList.remove("active")); // 隱藏所有圖片
      currentIndex = (index + images.length) % images.length; // 確保索引範圍正確
      images[currentIndex].classList.add("active"); // 顯示當前圖片
    }

    function showNextImage() {
      showImage(currentIndex + 1);
    }

    function showPrevImage() {
      showImage(currentIndex - 1);
    }

    prevButton.addEventListener("click", showPrevImage);
    nextButton.addEventListener("click", showNextImage);

    // ======== 圖片上傳功能 ========
    const uploadForm = document.getElementById("uploadForm");
    const imageUpload = document.getElementById("imageUpload");

    uploadForm.addEventListener("submit", (event) => {
      event.preventDefault();

      const file = imageUpload.files[0];
      if (file) {
        const formData = new FormData();
        formData.append("image", file);

        // 發送圖片到伺服器
        fetch("http://localhost:3000/upload", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            // 新增上傳的圖片到輪播
            const newImage = document.createElement("img");
            newImage.src = data.filePath; // 從伺服器獲取的圖片路徑
            newImage.alt = "上傳的活動圖片";
            imageContainer.appendChild(newImage); // 新增圖片到輪播容器
            if (imageContainer.querySelectorAll("img").length === 1) {
              showImage(0); // 如果是第一張圖片，立即顯示
            }
          })
          .catch((error) => {
            console.error("圖片上傳失敗:", error);
            alert("圖片上傳失敗，請稍後再試！");
          });
      } else {
        alert("請選擇一張圖片！");
      }
    });

    // ======== 載入現有圖片 ========
    window.addEventListener("load", () => {
      // 從伺服器獲取已上傳的圖片列表
      fetch("http://localhost:3000/uploads")
        .then((response) => response.json())
        .then((images) => {
          images.forEach((imagePath) => {
            const img = document.createElement("img");
            img.src = imagePath;
            img.alt = "活動圖片";
            imageContainer.appendChild(img);
          });
          showImage(0); // 顯示第一張圖片
        })
        .catch((error) => {
          console.error("載入圖片失敗:", error);
        });
    });

    // ======== 自動輪播功能 ========
    setInterval(showNextImage, 10000); // 每 10 秒自動切換圖片
  </script>
</body>

</html>